<!-- checkdata.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OCR ·∫£nh - Check Data</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="header-container"></div>

  <main style="text-align: center; padding: 30px;">
    <h2>üñºÔ∏è OCR ki·ªÉm tra d·ªØ li·ªáu t·ª´ ·∫£nh</h2>
    <p>T·∫£i l√™n ·∫£nh c√≥ ch·ª©a b·∫£ng s·ªë li·ªáu ho·∫∑c danh s√°ch, h·ªá th·ªëng s·∫Ω qu√©t v√† hi·ªÉn th·ªã k·∫øt qu·∫£.</p>

    <input type="file" id="imageUpload" accept="image/*"><br><br>
    <button onclick="processOCR()">üîç B·∫Øt ƒë·∫ßu nh·∫≠n d·∫°ng</button><br><br>

    <textarea id="ocrResult" rows="10" style="width: 90%; max-width: 800px;"></textarea><br><br>

    <h4>üìù Ki·ªÉm tra l·ªói ch√≠nh t·∫£</h4>
    <textarea id="spellInput" rows="5" style="width: 90%; max-width: 800px;" placeholder="D√°n n·ªôi dung OCR ho·∫∑c vƒÉn b·∫£n c·∫ßn ki·ªÉm tra..."></textarea><br><br>
    <button onclick="checkSpelling()">üß† Ki·ªÉm tra l·ªói</button>
  
<h5>K·∫øt qu·∫£ sau ki·ªÉm tra:</h5>
<div id="spellResult" style="padding:10px; border:1px solid #ccc; max-width:800px; margin:auto; white-space:pre-wrap;"></div>


  </main>

  <div id="footer-container"></div>

  <!-- OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
  <script>
    async function processOCR() {
      const file = document.getElementById('imageUpload').files[0];
      if (!file) return alert('Vui l√≤ng ch·ªçn ·∫£nh.');

      document.getElementById('ocrResult').value = '‚è≥ ƒêang nh·∫≠n d·∫°ng...';

      const reader = new FileReader();
      reader.onload = async function () {
        const { data: { text } } = await Tesseract.recognize(
          reader.result,
          'vie+eng',
          { logger: m => console.log(m) }
        );
        document.getElementById('ocrResult').value = text;
        document.getElementById('spellInput').value = text;
      };
      reader.readAsDataURL(file);
    }

   async function checkSpelling() {
  const text = document.getElementById("spellInput").value.trim();
  const resultDiv = document.getElementById("spellResult");
  resultDiv.innerHTML = "‚è≥ ƒêang ki·ªÉm tra...";

  if (!text) {
    alert("Vui l√≤ng nh·∫≠p n·ªôi dung.");
    return;
  }

  const res = await fetch("https://api.languagetool.org/v2/check", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: `text=${encodeURIComponent(text)}&language=vi`
  });
  const data = await res.json();

  if (!data.matches.length) {
    resultDiv.innerHTML = "<p style='color:green;'>‚úÖ Kh√¥ng ph√°t hi·ªán l·ªói ch√≠nh t·∫£.</p>";
    return;
  }

  // Highlight l·ªói
  let highlighted = text;
  const offset = { value: 0 }; // track offset due to inserted tags

  data.matches.forEach(match => {
    const from = match.offset + offset.value;
    const to = from + match.length;

    const wrongWord = highlighted.slice(from, to);
    const suggestion = match.replacements[0]?.value || "...";

    const span = `<span style="background:yellow;" title="G·ª£i √Ω: ${suggestion}">${wrongWord}</span>`;
    highlighted = highlighted.slice(0, from) + span + highlighted.slice(to);
    offset.value += span.length - match.length;
  });

  resultDiv.innerHTML = highlighted;
}

    // Load header + footer
    window.addEventListener("DOMContentLoaded", () => {
      fetch("header.html").then(r => r.text()).then(t => {
        document.getElementById("header-container").innerHTML = t;
      });
      fetch("footer.html").then(r => r.text()).then(t => {
        document.getElementById("footer-container").innerHTML = t;
      });
    });
  </script>
</body>
</html>
