<div class="header">
  <!-- TiÃªu Ä‘á» -->
  <header style="text-align: center;">
    <h2 id="titleText">âœ¨ Tdesign Daily Quote âœ¨</h2>
    <div id="greetingText" style="margin-top: 5px; font-weight: bold; color: #007700;"></div>
  </header>

  <!-- Google Sign-In -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <div id="g_id_onload"
       data-client_id="812902619403-7o2d3r3c8j855fhhhljkquqotdbdic68.apps.googleusercontent.com"
       data-callback="handleCredentialResponse"
       data-auto_prompt="false">
  </div>
  <div class="g_id_signin" data-type="standard"></div>

  <!-- Chá»n ngÃ´n ngá»¯ -->
  <div style="margin-top: 10px;">
    <select id="languageSelector" onchange="changeLanguage(this.value)">
      <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
      <option value="en">ğŸ‡ºğŸ‡¸ English</option>
    </select>
  </div>

  <!-- Navigation -->
  <div class="nav">
    <a href="index.html">Trang tá»•ng</a>
    <a href="ImageGenerator.html">GhÃ©p áº£nh</a>
    <a href="removebg.html">XÃ³a ná»n</a>
    <a href="qrcode.html">Táº¡o QR</a>
    <a href="about.html">LiÃªn há»‡</a>
  </div>
</div>

<script>
  const translations = {
    vi: { title: "âœ¨ Tdesign â€“ CÃ¢u truyá»n Ä‘á»™ng lá»±c âœ¨", hello: "ChÃ o" },
    en: { title: "âœ¨ Tdesign â€“ Daily Motivation âœ¨", hello: "Hello" }
  };

  let currentLang = localStorage.getItem("lang") || "vi";
  document.getElementById("languageSelector").value = currentLang;

  function changeLanguage(lang) {
    currentLang = lang;
    localStorage.setItem("lang", lang);
    const t = translations[lang];
    document.getElementById("titleText").innerText = t.title;
    const email = localStorage.getItem("userEmail");
    if (email) {
      document.getElementById("greetingText").innerText = `${t.hello}, ${email}`;
    }
  }

  function parseJwt(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
      '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
    return JSON.parse(jsonPayload);
  }

  async function handleCredentialResponse(response) {
    const decoded = parseJwt(response.credential);
    const email = decoded.email || "";

    localStorage.setItem("userEmail", email);

    // Kiá»ƒm tra quyá»n
    const emailFileUrl = 'https://raw.githubusercontent.com/DoHoangTan/tdesign.ai.vn/main/dsEmail.txt';
    let allowedEmails = [];
    try {
      const res = await fetch(emailFileUrl);
      const text = await res.text();
      allowedEmails = text.split(',').map(e => e.trim());
    } catch (e) {
      console.error("KhÃ´ng thá»ƒ táº£i danh sÃ¡ch email.");
    }

    if (!allowedEmails.includes(email)) {
      document.body.innerHTML = "<h3 style='color:red;'>Báº¡n khÃ´ng cÃ³ quyá»n sá»­ dá»¥ng chá»©c nÄƒng nÃ y.</h3>";
      return;
    }

    // Hiá»ƒn thá»‹ lá»i chÃ o
    const t = translations[currentLang];
    document.getElementById("greetingText").innerText = `${t.hello}, ${email}`;
  }

  // Tá»± Ä‘á»™ng khÃ´i phá»¥c sau reload
  window.addEventListener("DOMContentLoaded", () => {
    changeLanguage(currentLang);
    const email = localStorage.getItem("userEmail");
    if (email) {
      document.getElementById("greetingText").innerText = `${translations[currentLang].hello}, ${email}`;
    }
  });
</script>
