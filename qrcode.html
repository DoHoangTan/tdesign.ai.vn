<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Tạo mã QR | Tdesign</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f0f0f0;
      padding: 40px;
    }
    h1 {
      color: #cc0000;
    }
    input, select {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background: #0077cc;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #qrcode {
      margin-top: 30px;
      position: relative;
      display: inline-block;
    }
    #logoPreview {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 50px;
      height: 50px;
      transform: translate(-50%, -50%);
      object-fit: contain;
      border-radius: 8px;
    }
    .nav {
      margin-top: 40px;
    }
    .nav a {
      display: inline-block;
      margin: 10px;
      padding: 10px 20px;
      text-decoration: none;
      background: #0077cc;
      color: white;
      border-radius: 5px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
</head>
<body>

<div id="header-container"></div>
<script>
  fetch("header.html")
    .then(res => res.text())
    .then(data => document.getElementById("header-container").innerHTML = data);
</script>

<h1>Tạo mã QR</h1>
<input type="text" id="qrText" placeholder="Nhập nội dung để tạo mã QR">
<select id="colorSelect">
  <option value="#000000">Đen</option>
  <option value="#1f4e78">Xanh đậm</option>
  <option value="#d13438">Đỏ</option>
  <option value="#107c10">Xanh lá</option>
</select>
<select id="formatSelect">
  <option value="png">PNG</option>
  <option value="jpg">JPG</option>
  <option value="svg">SVG</option>
</select>
<input type="file" id="logoInput" accept="image/*">
<br><br>
<button onclick="generateQR()">Tạo mã QR</button>
<button onclick="downloadQR()">Tải về</button>

<div id="qrcode"></div>

<script>
  let logoBase64 = "";

  document.getElementById("logoInput").addEventListener("change", function () {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        logoBase64 = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  });

  function generateQR() {
    const text = document.getElementById("qrText").value.trim();
    const color = document.getElementById("colorSelect").value;
    const container = document.getElementById("qrcode");
    container.innerHTML = "";

    const canvas = document.createElement("canvas");
    const size = 300;
    canvas.width = size;
    canvas.height = size;

    const qr = new QRCode(canvas, {
      text: text,
      width: size,
      height: size,
      colorDark: color,
      colorLight: "#ffffff",
      correctLevel: QRCode.CorrectLevel.H
    });

    setTimeout(() => {
      const ctx = canvas.getContext("2d");
      if (logoBase64) {
        const img = new Image();
        img.onload = function () {
          const logoSize = size * 0.2;
          ctx.drawImage(img, (size - logoSize) / 2, (size - logoSize) / 2, logoSize, logoSize);
          container.innerHTML = "";
          container.appendChild(canvas);
        };
        img.src = logoBase64;
      } else {
        container.innerHTML = "";
        container.appendChild(canvas);
      }
    }, 300);
  }

  function downloadQR() {
    const canvas = document.querySelector("#qrcode canvas");
    if (!canvas) return alert("Vui lòng tạo mã QR trước!");

    const format = document.getElementById("formatSelect").value;
    let mime = "image/png";
    if (format === "jpg") mime = "image/jpeg";
    if (format === "svg") return alert("SVG chỉ hỗ trợ tải thủ công từ trình tạo khác.");

    const link = document.createElement("a");
    link.download = "tdesign-qrcode." + format;
    link.href = canvas.toDataURL(mime);
    link.click();
  }
</script>

</body>
</html>
